<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generador PDF AWS</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f9fafb;
      color: #111827;
    }

    header {
      background: #232f3e;
      color: white;
      padding: 16px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
    }

    main {
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }

    #uploadZone {
      border: 3px dashed #9ca3af;
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      background: #fff;
      transition: 0.2s;
    }

    #uploadZone:hover {
      border-color: #2563eb;
      background: #f0f9ff;
    }

    #fileInput {
      display: none;
    }

    #controlsSection {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }

    #controlsSection button {
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }

    #controlsSection button:hover {
      background: #1d4ed8;
    }

    #btnClear {
      background: #ef4444;
    }

    #btnClear:hover {
      background: #dc2626;
    }

    #imagesContainer {
      margin-top: 20px;
    }

    #imagesGrid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .image-card {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 10px;
      position: relative;
      text-align: center;
    }

    .image-card img {
      width: 100%;
      height: 180px;
      object-fit: contain;
      border-radius: 8px;
      border: 1px solid #d1d5db;
    }

    .image-remove {
      position: absolute;
      top: 5px;
      right: 5px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-weight: bold;
    }

    .image-name {
      margin-top: 6px;
      font-size: 13px;
      color: #374151;
      word-break: break-all;
    }

    .hidden {
      display: none;
    }

    footer {
      text-align: center;
      color: #6b7280;
      margin-top: 30px;
      font-size: 14px;
    }

    #examName {
      width: 100%;
      padding: 10px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      margin-top: 20px;
    }

    #emptyState {
      margin-top: 40px;
      text-align: center;
      color: #6b7280;
      font-size: 16px;
    }
  </style>
</head>
<body>

  <header>Generador de PDF - Examen AWS</header>

  <main>
    <div id="uploadZone">
      <p>üìÅ Arrastra tus im√°genes aqu√≠ o haz clic para seleccionarlas</p>
      <input type="file" id="fileInput" multiple accept="image/*" />
    </div>

    <input type="text" id="examName" placeholder="Nombre del examen (opcional)" />

    <section id="controlsSection" class="hidden">
      <button id="btnSort">Ordenar</button>
      <button id="btnGenerate">Generar PDF</button>
      <button id="btnClear">üóëÔ∏è Limpiar todo</button>
    </section>

    <section id="imagesContainer" class="hidden">
      <p>Total de im√°genes: <span id="imageCount">0</span></p>
      <div id="imagesGrid"></div>
    </section>

    <div id="emptyState">No hay im√°genes cargadas</div>
  </main>

  <footer>¬© 2025 - Herramienta AWS PDF Generator</footer>

  <script>
    let images = [];
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const imagesGrid = document.getElementById('imagesGrid');
    const imagesContainer = document.getElementById('imagesContainer');
    const emptyState = document.getElementById('emptyState');
    const controlsSection = document.getElementById('controlsSection');
    const imageCount = document.getElementById('imageCount');
    const btnSort = document.getElementById('btnSort');
    const btnClear = document.getElementById('btnClear');
    const btnGenerate = document.getElementById('btnGenerate');

    uploadZone.onclick = () => fileInput.click();
    fileInput.onchange = e => handleFiles(e.target.files);
    uploadZone.ondragover = e => e.preventDefault();
    uploadZone.ondrop = e => {
      e.preventDefault();
      handleFiles(e.dataTransfer.files);
    };

    btnSort.onclick = e => {
      e.preventDefault();
      sortImages();
    };

    // ‚úÖ Limpieza directa sin confirmaci√≥n
    btnClear.onclick = e => {
      e.preventDefault();
      clearAll();
    };

    btnGenerate.onclick = e => {
      e.preventDefault();
      generatePDF();
    };

    function handleFiles(files) {
      for (const file of files) {
        if (file.type.startsWith('image')) {
          const reader = new FileReader();
          reader.onload = e => {
            images.push({
              id: Date.now() + Math.random(),
              name: file.name,
              data: e.target.result
            });
            updateUI();
          };
          reader.readAsDataURL(file);
        }
      }
    }

    function updateUI() {
      if (images.length > 0) {
        emptyState.classList.add('hidden');
        imagesContainer.classList.remove('hidden');
        controlsSection.classList.remove('hidden');
        imageCount.textContent = images.length;
        renderImages();
      } else {
        emptyState.classList.remove('hidden');
        imagesContainer.classList.add('hidden');
        controlsSection.classList.add('hidden');
      }
    }

    function renderImages() {
      imagesGrid.innerHTML = images
        .map(
          (img, i) => `
          <div class="image-card">
            <img src="${img.data}" />
            <button class="image-remove" onclick="removeImage(${i})">√ó</button>
            <div class="image-name">${img.name}</div>
          </div>`
        )
        .join('');
    }

    function removeImage(index) {
      images.splice(index, 1);
      updateUI();
    }

    function clearAll() {
      images = [];
      fileInput.value = '';
      imagesGrid.innerHTML = '';
      imageCount.textContent = '0';
      updateUI();
    }

    function sortImages() {
      images.sort((a, b) => {
        const numA = parseInt(a.name.match(/\d+/)) || 0;
        const numB = parseInt(b.name.match(/\d+/)) || 0;
        return numA - numB;
      });
      updateUI();
    }

    function generatePDF() {
      if (images.length === 0) {
        alert('Por favor, sube al menos una imagen primero');
        return;
      }

      const examName = document.getElementById('examName').value || 'Examen AWS';
      const win = window.open('', '_blank', 'width=900,height=700');

      if (!win) {
        alert('Tu navegador bloque√≥ la ventana emergente. Permite pop-ups e int√©ntalo de nuevo.');
        return;
      }

      let html = `
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <title>${examName}</title>
        <style>
          @page { size: A4; margin: 1cm; }
          body { margin: 0; font-family: Arial; }
          .cover { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; page-break-after: always; }
          .cover h1 { font-size: 48px; color: #232f3e; margin-bottom: 20px; }
          .cover p { font-size: 24px; color: #666; }
          .page { page-break-after: always; padding: 20px; }
          .page:last-child { page-break-after: auto; }
          .page img { width: 100%; height: auto; border: 1px solid #ddd; border-radius: 10px; }
          .instructions { position: fixed; top: 20px; right: 20px; background: #232f3e; color: white; padding: 20px; border-radius: 10px; }
          @media print { .instructions { display: none; } }
          button { background: #10b981; color: white; border: none; border-radius: 6px; padding: 10px 16px; cursor: pointer; margin-top: 10px; }
        </style>
      </head>
      <body>
        <div class="cover">
          <h1>${examName}</h1>
          <p>${images.length} Preguntas</p>
        </div>
      `;

      images.forEach((img, i) => {
        html += `
          <div class="page">
            <p><strong>Pregunta ${i + 1} / ${images.length}</strong></p>
            <img src="${img.data}" />
          </div>`;
      });

      html += `
        <div class="instructions">
          <b>Guardar como PDF:</b><br>
          Ctrl + P (Windows) o Cmd + P (Mac)<br>
          Selecciona "Guardar como PDF"
          <br><button onclick="window.print()">üñ®Ô∏è Imprimir/Guardar</button>
        </div>
      </body>
      </html>`;

      win.document.write(html);
      win.document.close();
    }
  </script>

</body>
</html>
